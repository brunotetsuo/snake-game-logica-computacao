<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cobrinha do Luiz L√≥gica de Computa√ß√£o</title>
  <style>
    :root {
      --bg: #0f1724;
      --grid: #0b1220;
      --snake: #7ee787;
      --food: #4dabf7;
      --panel: #0b1220cc;
      --text: #e6eef8;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, var(--bg), #071025);
      color: var(--text);
      font-family: Inter, system-ui, sans-serif;
      gap: 12px;
      overflow: hidden;
    }

    h2 {
      font-size: 22px;
      text-align: center;
      max-width: 500px;
    }

    canvas {
      background: linear-gradient(180deg, var(--grid), #031026);
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.02);
      image-rendering: pixelated;
    }

    .score {
      font-size: 20px;
    }

    button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      background: #0b2036;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
    }

    /* NOVA TELA INICIAL UNIFICADA */
    .start-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(15, 23, 36, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      z-index: 10;
      animation: fadeIn 0.4s ease;
    }

    input {
      padding: 10px;
      font-size: 18px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: none;
      outline: none;
      text-align: center;
    }

    .start-screen h1 {
      font-size: 34px;
      text-align: center;
      color: #7ee787;
    }

    #rankingBox {
      margin-top: 10px;
      font-size: 18px;
      text-align: center;
    }
  </style>
</head>

<body>
  <!-- TELA INICIAL UNIFICADA -->
  <div class="start-screen" id="startScreen">
    <h1>Cobrinha do Luizüêç<br />L√≥gica de Computa√ß√£o</h1>

    <input id="playerName" placeholder="Digite seu nome" maxlength="15" />
    <button id="startBtn">Iniciar Jogo</button>
    <div id="rankingBox"></div>
  </div>

  <h2 id="question">Clique em Iniciar para come√ßar</h2>
  <canvas id="game" width="600" height="600"></canvas>
  <div class="score" id="score">Score: 0</div>
  <div class="score" id="timer">Tempo: 30s</div>
  <button id="pauseBtn">Pausar</button>

  <script>
    /* ========= RANKING LOCAL STORAGE ========= */
    let playerName = "";

    function saveRanking(name, score) {
      const ranking = JSON.parse(localStorage.getItem("snakeRanking") || "[]");
      ranking.push({ name, score });
      ranking.sort((a, b) => b.score - a.score);
      localStorage.setItem("snakeRanking", JSON.stringify(ranking));
    }

    function loadRanking() {
      return JSON.parse(localStorage.getItem("snakeRanking") || "[]");
    }

    function showRanking() {
      const data = loadRanking();
      const rankingBox = document.getElementById("rankingBox");

      if (!data.length) {
        rankingBox.innerHTML = "<b>Ningu√©m jogou ainda!</b>";
      } else {
        rankingBox.innerHTML = "<h3>üèÜ Ranking</h3>" +
          data.slice(0, 5).map(e => `${e.name}: ${e.score}`).join("<br>");
      }
    }

    let bgMusic = new Audio("music.mp3");
    bgMusic.loop = true;
    bgMusic.volume = 0.3;

    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const questionEl = document.getElementById("question");
    const scoreEl = document.getElementById("score");
    const timerEl = document.getElementById("timer");
    const pauseBtn = document.getElementById("pauseBtn");
    const startScreen = document.getElementById("startScreen");
    const startBtn = document.getElementById("startBtn");

    const TILE_COUNT = 20;
    let tileSize = canvas.width / TILE_COUNT;

    const correctSound = new Audio("correct.wav");
    const wrongSound = new Audio("failure.wav");

    let questions = [
      { q: "Se, somente se", options: ["‚Üî", "‚Üí"], correct: 0 },
      { q: "E", options: ["‚à®", "‚àß"], correct: 1 },
      { q: "True ‚àß True", options: ["True", "False"], correct: 0 },
      { q: "True ‚Üí False", options: ["False", "True"], correct: 0 },
      { q: "N√£o True", options: ["True", "False"], correct: 1 },
      { q: "True ‚à® False", options: ["False", "True"], correct: 1 },
    ];

    questions = questions.sort(() => Math.random() - 0.5);

    let snake, dir, nextDir, foods, score, gameOver, currentQuestion, paused;
    let effectColor = null;
    let effectTimer = 0;
    let running = false;

    /* ==== TIMER ===== */
    let timeLeft = 60;
    let timerInterval = null;

    function startTimer() {
      timerInterval = setInterval(() => {
        if (!paused && !gameOver) {
          timeLeft--;

          if (timeLeft <= 10) {
            timerEl.style.color = timeLeft % 2 === 0 ? "#ff4d4d" : "#ffffff";
            timerEl.style.transform = timeLeft % 2 === 0 ? "scale(1.2)" : "scale(1)";
          }

          timerEl.textContent = "Tempo: " + timeLeft + "s";

          if (timeLeft <= 0) {
            gameOver = true;
            clearInterval(timerInterval);
            saveRanking(playerName, score);
          }
        }
      }, 1000);
    }


    function spawnFoods() {
      const pos = [];
      while (pos.length < 2) {
        const p = {
          x: Math.floor(Math.random() * TILE_COUNT),
          y: Math.floor(Math.random() * TILE_COUNT),
        };
        if (
          !snake.some((s) => s.x === p.x && s.y === p.y) &&
          !pos.some((f) => f.x === p.x && f.y === p.y)
        ) {
          pos.push(p);
        }
      }
      return pos;
    }

    function resetGame() {
      snake = Array.from({ length: 1 }, (_, i) => ({ x: 10 - i, y: 10 }));
      dir = { x: 0, y: 0 };
      nextDir = { x: 0, y: 0 };
      currentQuestion = 0;
      questionEl.textContent = "Clique em Iniciar para come√ßar";
      foods = spawnFoods();
      score = 0;
      gameOver = false;
      paused = false;
      running = false;
      timeLeft = 60;
      timerEl.textContent = "Tempo: 1 Minuto";
      clearInterval(timerInterval);
      scoreEl.textContent = "Score: " + score;
      draw();
    }

    function setNextDir(x, y) {
      if (dir.x === -x && dir.y === -y) return;
      nextDir = { x, y };
    }

    window.addEventListener("keydown", (e) => {
      const key = e.key.toLowerCase();
      if (key === "arrowup" || key === "w") setNextDir(0, -1);
      if (key === "arrowdown" || key === "s") setNextDir(0, 1);
      if (key === "arrowleft" || key === "a") setNextDir(-1, 0);
      if (key === "arrowright" || key === "d") setNextDir(1, 0);
      if (key === " " && running) paused = !paused;
    });

    startBtn.addEventListener("click", () => {
      const input = document.getElementById("playerName");
      if (!input.value.trim()) return alert("Digite seu nome!");
      playerName = input.value.trim();

      bgMusic.play();
      startScreen.style.display = "none";
      resetGame();
      dir = { x: 1, y: 0 };
      nextDir = { x: 1, y: 0 };
      running = true;
      questionEl.textContent = questions[currentQuestion].q;
      startTimer();
      requestAnimationFrame(loop);
    });

    showRanking();

    pauseBtn.addEventListener("click", () => {
      if (!running) return;
      paused = !paused;
      if (paused) {
        pauseBtn.textContent = "Continuar";
        bgMusic.pause();
      } else {
        pauseBtn.textContent = "Pausar";
        bgMusic.play();
      }
    });

    function update() {
      if (gameOver || paused || !running) return;

      if (nextDir.x !== 0 || nextDir.y !== 0) dir = { ...nextDir };
      const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };

      if (head.x < 0) head.x = TILE_COUNT - 1;
      if (head.x >= TILE_COUNT) head.x = 0;
      if (head.y < 0) head.y = TILE_COUNT - 1;
      if (head.y >= TILE_COUNT) head.y = 0;

      if (snake.some((s, i) => i > 0 && s.x === head.x && s.y === head.y)) {
        gameOver = true;
        clearInterval(timerInterval);
        saveRanking(playerName, score);
        return;
      }

      snake.unshift(head);

      const ateIndex = foods.findIndex(
        (f) => f.x === head.x && f.y === head.y
      );

      if (ateIndex !== -1) {
        const isCorrect = ateIndex === questions[currentQuestion].correct;

        if (isCorrect) {
          score++;
          correctSound.play();
          effectColor = "rgba(0,255,100,0.4)";
          // N√ÉO FAZ MAIS push, o crescimento ocorre pelo unshift sem pop
        } else {
          wrongSound.play();
          effectColor = "rgba(255,0,0,0.4)";
          if (snake.length <= 2) {
            gameOver = true;
            clearInterval(timerInterval);
            saveRanking(playerName, score);
          } else {
            snake.pop();
            snake.pop();
          }
        }

        scoreEl.textContent = "Score: " + score;
        currentQuestion = (currentQuestion + 1) % questions.length;
        questionEl.textContent = questions[currentQuestion].q;
        foods = spawnFoods();
        effectTimer = 15;
      } else {
        snake.pop();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      tileSize = canvas.width / TILE_COUNT;

      snake.forEach((s, i) => {
        ctx.fillStyle = `rgba(126,231,135,${0.2 + 0.8 * (1 - i / snake.length)})`;
        ctx.fillRect(s.x * tileSize, s.y * tileSize, tileSize, tileSize);
      });

      foods.forEach((f, i) => {
        ctx.fillStyle = "#4dabf7";
        ctx.fillRect(f.x * tileSize, f.y * tileSize, tileSize, tileSize);

        ctx.fillStyle = "#fff";
        ctx.font = "bold 28px Inter";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(questions[currentQuestion].options[i],
          f.x * tileSize + tileSize / 2,
          f.y * tileSize + tileSize / 2
        );
      });

      if (gameOver) {
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.fillStyle = "#ff6b6b";
        ctx.font = "bold 42px Inter";
        ctx.textAlign = "center";
        ctx.fillText("GAME OVER!", canvas.width / 2, canvas.height / 2);

        setTimeout(() => location.reload(), 1500);
      }
    }

    let frameCount = 0;
    const speed = 10;

    function loop() {
      if (!running) return;

      frameCount++;
      if (frameCount % speed === 0) update();
      draw();
      requestAnimationFrame(loop);
    }

    resetGame();
  </script>
</body>

</html>